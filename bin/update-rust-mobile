#!/bin/bash

# Make sure nightly is to date, to match the stdlibs we're going to install.
multirust update nightly

# Make workspace for rust installers
mkdir -p /tmp/rust-installs
pushd /tmp/rust-installs

install_rust_stdlib ()
{
    if [ -z "$1" ]
    then
	return;
    fi

    local arch="$1"
    local arch_path="rust-std-nightly-${arch}-apple-ios"
    curl -O "http://static.rust-lang.org/dist/${arch_path}.tar.gz"
    tar zxf "$arch_path.tar.gz"
    pushd $arch_path
    ./install.sh --prefix=$(multirust run nightly rustc --print sysroot)
    popd
}


# Install stdlib for all desired iOS platforms -- device and sim.
ARCHS="aarch64 armv7s i386 x86_64"
for arch in $ARCHS; do
    install_rust_stdlib $arch
done

# Cleanup workspace
popd
rm -rf /tmp/rust-installs
